<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.1.0/dist/MarkerCluster.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.1.0/dist/MarkerCluster.Default.css">
    <script src="https://unpkg.com/leaflet.markercluster@1.1.0/dist/leaflet.markercluster.js"></script>
    <script src="https://unpkg.com/leaflet-ajax@2.1.0/dist/leaflet.ajax.min.js"></script>
    <title>Title</title>
</head>

<body>
    <a href="https://github.com/jikuja/leaflet-liikennemerkit"><img style="position: absolute; top: 0; right: 0; border: 0;z-index: 9999;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
    <div id="mapid" style="height: 600px;"></div>

    <script>
        var signAttribution =
            'Sign data &copy; <a href="http://www.lounaistieto.fi/blog/2016/03/30/turun-kaupungin-liikennemerkit/">Turun kaupunki</a>, ' +
            '<a href="https://creativecommons.org/licences/by/4.0/deed.fi">CC-BY</a>';

        var mymap = L.map('mapid').setView([60.440963, 22.25122], 10);
        var signMapping;

        L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution:
                'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
            id: 'mapbox.streets'
        }).addTo(mymap);

        var clusterGroup = L.markerClusterGroup({
            // attribution in geojsonLayer is ignored
            attribution: signAttribution,
            disableClusteringAtZoom : 18
        });
        var geojsonLayer = new L.GeoJSON.AJAX("liikennemerkit.json");
        mymap.addLayer(clusterGroup);

        geojsonLayer.on("data:loaded", function () {
            // add geojson layer into cluster layer after data is loaded
            clusterGroup.addLayer(geojsonLayer);
        });

        // load mapping
        $.getJSON("merkit_map.json", function (json) {
            signMapping = json;
        });

        var popup = L.popup();
        function fix(s) {
            var ret = s.match(/(\d+)([a-zöäå]+)/);
            if (ret) {
                var value = ret[1] + " " + ret[2];
                console.log("Fixed %s to %s", s, value)
                return value;
            }
            return s;
        }
        function onMapClick(e) {
            prop = e.layer.feature.properties;
            console.log(prop);
            popup.setLatLng(e.latlng)
                .setContent(signMapping[fix(prop["signtype"])])
                .openOn(mymap);
        }
        geojsonLayer.on("click", onMapClick)
    </script>
</body>

</html>